var Boxed=function(t,e,i){this.pos=new Vect2d(t,e),this.vel=new Vect2d(0,0),this.acc=new Vect2d(0,0),this.size=i||random(minsize,maxsize),this.value=null,this.name="",this.mouseover=!1,this.pressed=!1,this.dragged=!1,this.immortal=!1,this.mutable=!0,this.icon=null,this.link="",Boxed.prototype.setMutable=function(t){this.mutable=t},Boxed.prototype.isMutable=function(){return this.mutable},Boxed.prototype.isMouseOver=function(){return this.mouseover},Boxed.prototype.isPressed=function(){return this.pressed},Boxed.prototype.isDragged=function(){return this.dragged},Boxed.prototype.setPressed=function(t){this.pressed=t},Boxed.prototype.setDragged=function(t){this.dragged=t},Boxed.prototype.setLink=function(t){return this.link=t,this},Boxed.prototype.setIcon=function(t){return this.icon=t,this},Boxed.prototype.getValue=function(){return this.value},Boxed.prototype.setValue=function(t){return this.value=t,null!==this.value?this.mutable=!1:this.mutable=!0,this},Boxed.prototype.getName=function(){return this.name},Boxed.prototype.setName=function(t){return this.name=t,this},Boxed.prototype.getSize=function(){return this.size},Boxed.prototype.setSize=function(t){return this.size=t,this},Boxed.prototype.display=function(){this.mouseover=this.contains(mouseX,mouseY),this.mouseover&&(mouseoverboxed=this),fill(this.mouseover?this.pressed?white:yellow:orange),rect(this.x1(),this.y1(),this.size,this.size),null!==this.value&&image(this.value,this.x1()-2,this.y1()-2,this.size+4,this.size+4)},Boxed.prototype.setCenter=function(t,e){this.pos.set(t,e)},Boxed.prototype.getPos=function(){return this.pos},Boxed.prototype.x=function(){return this.pos.x},Boxed.prototype.y=function(){return this.pos.y},Boxed.prototype.width=function(){return this.size},Boxed.prototype.height=function(){return this.size},Boxed.prototype.intersects=function(t,e,i,s){return!(this.x2()<t||i<this.x1()||this.y2()<e||s<this.y1())},Boxed.prototype.intersectsBoxed=function(t){return!(this.x2()<t.x1()||t.x2()<this.x1()||this.y2()<t.y1()||t.y2()<this.y1())},Boxed.prototype.contains=function(t,e){return t>=this.x1()&&e>=this.y1()&&t<=this.x2()&&e<=this.y2()},Boxed.prototype.x1=function(){return this.pos.x-.5*this.size},Boxed.prototype.x2=function(){return this.pos.x+.5*this.size},Boxed.prototype.y1=function(){return this.pos.y-.5*this.size},Boxed.prototype.y2=function(){return this.pos.y+.5*this.size},Boxed.prototype.applyForce=function(t){this.acc.add(t)},Boxed.prototype.update=function(){this.pressed||(this.vel.add(this.acc),this.vel.limit(maxspeed),this.pos.add(this.vel),this.vel.scale(.9999),this.acc.scale(0))},Boxed.prototype.seek=function(t){this.applyForce(Vect2d.prototype.subtract(t,this.pos).setMag(maxspeed).sub(this.vel).limit(maxforce))},Boxed.prototype.avoid=function(t){this.applyForce(Vect2d.prototype.subtract(this.pos,t).setMag(maxspeed).sub(this.vel).limit(maxforce))},Boxed.prototype.separate=function(t){for(var e=new Vect2d,i=0,s=0;s<t.length;s++){var n=t[s],o=Vect2d.prototype.dist(this.pos,n.pos),r=.5*(this.size+n.size);o>0&&r>o&&(this.immortal=!0,n.immortal||n.onImpact(),e.add(Vect2d.prototype.subtract(this.pos,n.pos).setMag(1/o)),i++)}i>0?this.applyForce(e.div(i).setMag(maxspeed).sub(this.vel).limit(maxforce*this.size)):this.immortal=!1},Boxed.prototype.onImpact=function(){if(this.mutable){var t=this.size;if(t>minsize)for(var e=0;e<random(2,.5*t);e++){var i=new Boxed(this.x()+random(1,-1),this.y()+random(1,-1),random(.5*t,.8*t));i.immortal=!0,addons[addons.length]=i}removals[removals.length]=this}},Boxed.prototype.stayWithin=function(t){this.x1()<=t.x1()?this.applyForce(new Vect2d(maxspeed,this.vel.y).sub(this.vel).limit(maxforce)):this.x2()>=t.x2()?this.applyForce(new Vect2d(-maxspeed,this.vel.y).sub(this.vel).limit(maxforce)):this.y1()<=t.y1()?this.applyForce(new Vect2d(this.vel.x,maxspeed).sub(this.vel).limit(maxforce)):this.y2()>=t.y2()&&this.applyForce(new Vect2d(this.vel.x,-maxspeed).sub(this.vel).limit(maxforce))}},EMPTY=0,LEAF=1,POINTER=2,SingleQuad=function(t,e,i,s,n){this.x=t||0,this.y=e||0,this.w=i||width,this.h=s||height,this.parent=n||null,this.nw,this.ne,this.sw,this.se,this.value=null,this.type=EMPTY,SingleQuad.prototype.size=function(){switch(this.type){case EMPTY:case LEAF:return 1;case POINTER:var t=0;return t+=this.nw.size(),t+=this.ne.size(),t+=this.sw.size(),t+=this.se.size()}},SingleQuad.prototype.add=function(t){if(!this.contains(t.x(),t.y()))return!1;switch(this.type){case EMPTY:return this.put(t),!0;case LEAF:this.subdivide();case POINTER:if(this.nw.contains(t.x(),t.y()))return this.nw.add(t);if(this.ne.contains(t.x(),t.y()))return this.ne.add(t);if(this.sw.contains(t.x(),t.y()))return this.sw.add(t);if(this.se.contains(t.x(),t.y()))return this.se.add(t)}},SingleQuad.prototype.put=function(t){this.value=t,this.type=LEAF},SingleQuad.prototype.subdivide=function(){var t=.5*this.w,e=.5*this.h,i=this.x,s=this.y;this.nw=new SingleQuad(i,s,t,e,this),this.ne=new SingleQuad(i+t,s,t,e,this),this.sw=new SingleQuad(i,s+e,t,e,this),this.se=new SingleQuad(i+t,s+e,t,e,this);var n=this.value;this.value=null,this.type=POINTER,this.nw.contains(n.x(),n.y())?this.nw.put(n):this.ne.contains(n.x(),n.y())?this.ne.put(n):this.sw.contains(n.x(),n.y())?this.sw.put(n):this.se.contains(n.x(),n.y())&&this.se.put(n)},SingleQuad.prototype.remove=function(t){},SingleQuad.prototype.balance=function(){},SingleQuad.prototype.resizeQuad=function(t,e){this.w=t,this.h=e},SingleQuad.prototype.clear=function(){this.value=null,this.nw=null,this.ne=null,this.sw=null,this.se=null,this.type=EMPTY,this.parent=null},SingleQuad.prototype.display=function(){switch(fill(0,5),this.type){case POINTER:this.nw.display(),this.ne.display(),this.sw.display(),this.se.display();case LEAF:case EMPTY:rect(this.x,this.y,this.w,this.h)}},SingleQuad.prototype.traverse=function(t){this.type===POINTER?(null!==this.nw&&this.nw.traverse(t),null!==this.ne&&this.ne.traverse(t),null!==this.sw&&this.sw.traverse(t),null!==this.se&&this.se.traverse(t)):t(this)},SingleQuad.prototype.getObjectAt=function(i,s){switch(type){case POINTER:if(null!==this.nw.getObjectAt(t,e))return nw.getObjectAt(t,e);if(null!==this.ne.getObjectAt(t,e))return ne.getObjectAt(t,e);if(null!==this.sw.getObjectAt(t,e))return sw.getObjectAt(t,e);if(null!==this.se.getObjectAt(t,e))return se.getObjectAt(t,e);case LEAF:return null!==this.value&&this.value.getBox().contains(t,e)?this.value:null;default:return null}},SingleQuad.prototype.getQuadAt=function(t,e){if(this.contains(t,e)){if(this.type===LEAF)return this;if(this.type===POINTER){if(this.nw.contains(t,e))return this.nw.getQuadAt(t,e);if(this.ne.contains(t,e))return this.ne.getQuadAt(t,e);if(this.sw.contains(t,e))return this.sw.getQuadAt(t,e);if(this.se.contains(t,e))return this.se.getQuadAt(t,e)}}},SingleQuad.prototype.getObjectsUnder=function(t){var e=[];return this.getObjectsUnderInternal(e,t)},SingleQuad.prototype.getObjectsUnderInternal=function(t,e){return this.intersectsBoxed(e)&&(this.type===LEAF?t[t.length]=this.value:this.type===POINTER&&(this.nw.getObjectsUnderInternal(t,e),this.ne.getObjectsUnderInternal(t,e),this.sw.getObjectsUnderInternal(t,e),this.se.getObjectsUnderInternal(t,e))),t},SingleQuad.prototype.getQuadsUnder=function(t){var e=[];return this.getQuadsUnderInternal(e,t)},SingleQuad.prototype.getQuadsUnderInternal=function(t,e){return this.intersectsBoxed(e)&&(this.type===LEAF?t[t.length]=this:this.type===POINTER&&(this.nw.getQuadsUnderInternal(t,e),this.ne.getQuadsUnderInternal(t,e),this.sw.getQuadsUnderInternal(t,e),this.se.getQuadsUnderInternal(t,e))),t},SingleQuad.prototype.getRoot=function(){return null===this.parent?this:this.parent.getRoot()},SingleQuad.prototype.getValue=function(){return this.value},SingleQuad.prototype.getType=function(){return this.type},SingleQuad.prototype.getParent=function(){return this.parent},SingleQuad.prototype.xcenter=function(){return this.x+.5*this.w},SingleQuad.prototype.ycenter=function(){return this.y+.5*this.h},SingleQuad.prototype.width=function(){return this.w},SingleQuad.prototype.height=function(){return this.h},SingleQuad.prototype.x1=function(){return this.x},SingleQuad.prototype.y1=function(){return this.y},SingleQuad.prototype.x2=function(){return this.x+this.w},SingleQuad.prototype.y2=function(){return this.y+this.h},SingleQuad.prototype.contains=function(t,e){return t>=this.x1()&&e>=this.y1()&&t<=this.x2()&&e<=this.y2()},SingleQuad.prototype.containsBoxed=function(t){return t.x1()>=this.x1()&&t.y1()>=this.y1()&&t.x2()<=this.x2()&&t.y2()<=this.y2()},SingleQuad.prototype.intersects=function(t,e,i,s){return!(this.x2()<t||i<this.x1()||this.y2()<e||s<this.y1())},SingleQuad.prototype.intersectsBoxed=function(t){return!(this.x2()<t.x1()||t.x2()<this.x1()||this.y2()<t.y1()||t.y2()<this.y1())}},Vect2d=function(t,e){this.x=t||0,this.y=e||0,Vect2d.prototype.set=function(t,e){return this.x=t,this.y=e,this},Vect2d.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},Vect2d.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},Vect2d.prototype.subtract=function(t,e){return new Vect2d(t.x-e.x,t.y-e.y)},Vect2d.prototype.dist=function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)},Vect2d.prototype.distSq=function(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s},Vect2d.prototype.mult=function(t){return this.x*=t.x,this.y*=t.y,this},Vect2d.prototype.scale=function(t){return this.x*=t,this.y*=t,this},Vect2d.prototype.div=function(t){return this.x/=t,this.y/=t,this},Vect2d.prototype.normalize=function(){var t=this.mag();return t>1&&this.div(t),this},Vect2d.prototype.setMag=function(t){return this.normalize(),this.scale(t),this},Vect2d.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vect2d.prototype.magSq=function(){return this.x*this.x+this.y*this.y},Vect2d.prototype.theta=function(){return atan2(e,t)},Vect2d.prototype.limit=function(t){return this.magSq()>t*t&&(this.normalize(),this.scale(t)),this}};